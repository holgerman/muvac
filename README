### INFO
muvac is a fully multithreaded pipeline to call, merge and annotate germline variants
- from RAW sequencing data in FastQ format,
- trimmed using Trimmomatic,
- corrected using Rcorrector,
- mapped by Segemehl, TopHat2, BWA,
- using Freebayes, HaplotypeCaller, MuTect2, Samtools, Platypus

### INSTALLATION
1) you need to be root to install dependencies, unless already present (to check this go on with step 2)
sudo apt-get update
sudo apt-get install cmake install git g++ gcc make openjdk-8-jdk python-dev unzip
2) create a directory for muvac tools installation, which can changed here (default is current working directory with absolute path $PWD)
mkdir -p $PWD/muvactools
3) create a shell variable MUVAC assigned to your previous defined installation directory
export MUVAC=$PWD/muvactools
4) store the MUVAC variable permanently to ensure that muvac can always find the required tools
echo "export MUVAC=$MUVAC" >> ~/.bashrc
5) download the latest muvac release from https://github.com/koriege/muvac/releases
wget https://github.com/rna-hta-jena/gorap/archive/muvac-v0.1.0.zip
6) extract the downloaded muvac release
unzip muvac-v0.1.0.zip
7) enter the muvac directory
cd muvac-0.1.0
8) install required tools for muvac
./muvac -i all

### DOWNLOAD HG19/GRCh37.p13 and dbSNP vcf
1) create a genome directory
mkdir -p $PWD/genomes
2) download hg19 genome and corresponding dbSNP vcf into your genomes directory
./dlhg19 $PWD/genomes

### RUN
- make sure to have your genome and dbSNP vcf file in the same directory
- make sure your genome file ends with '.fa' and your dbSNP file ends with '.fa.vcf'
- make sure the file name prefixes of your genome and dbSNP file are equal (e.g. hg19.fa and hg19.fa.vcf)
- make sure the fasta headers in your genome are in this order and termed '>chrM' '>chr1' ... '>chr22' '>chrX' '>chrY'
=> running dlhg19 from the DOWNLOAD section will do this for you
1) calling for help?
./muvac -h
2) adapt and use the terminal command below
./muvac -1 R1.fastq -2 R2.fastq -g genomes/hg19.fa -o results -l results/run.log

### INFO: RUN
- a comprehensive log file 'run.log' file will be created in your output directory, unless defined otherwise
- using the verbose option '-v' will additionally print full log to terminals stdout
- example run for multiple patients data to be processed in parallel
./muvac -1 patient1_1.fq,patient2_1.fq -2 patient1_2.fq,patient2_2.fq -g genomes/hg19.fa -o results -l results/run.log

### RUN IN BACKGROUND
1) start a screen with a unique name
screen -S myMUVACrun
2) run muvac
3) detach the screen by pressing all 3 keys 'ctr+a+d'
4) list screens running in background
screen -ls
4) resume a screen 
screen -r myMUVACrun

### RESULTS
- results can be found in the vcf/(segemehl|tophat|bwa) directories
- merged results are named *.merged.vcf

### INFO: MERGED RESULTS
- muvac returns the score columns of the first caller in alphabetic order, which is freebayes unless deactivated
- '*.reduced.vcf' files contain only the info column of the first caller in alphabetic order, which is freebayes unless deactivated

### INFO: MULTIALLELIC REPORTS
- bcftools-norm is used to split them into single reports with related genotype (GT), genotype quality (GQ) and coverage (DP)
=> muvac returns the best report according to GQ and DP

### INTERMEDIATE RESULTS (in processing order)
- qualities directory: raw read quality statistics by FastQC
- converted directory: phred64 to phred33 quality converted raw reads by fastx_toolkit
- trimmed directory: quality trimmed reads by Trimmomatic
- rawcorrected directory: error corrected reads by Rcorrector
- mapped/(segemehl|tophat|bwa) directory: sorted mapping data '*.bam' by Segemehl|TopHat2|BWA
- noduplicates/(segemehl|tophat|bwa) directory: duplicate marked mapping data '*.bam' by Picard 
- errorcorrected/(segemehl|tophat|bwa) directory: relaigned and reaclibrated mapping data '*.reordered.bam' by GATK

### GENERAL CALLER PARAMETER
if adjustable, all callers are constrained by
min reads >= 10
allele frequency >= 0.1
alternative alleles <= 3
min base quality >= 0
max variances = all
downsampling = off

### AUTHOR
Konstantin Riege
konstantin{a}bioinf{.}uni-leipzig{.}de